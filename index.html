<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warp Starfield</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            transition: opacity 0.3s;
            z-index: 10;
        }
        #controls.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #controls div {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        label {
            width: 120px; /* Fixed width for labels to align inputs */
            text-align: right;
            margin-right: 10px;
        }
        input[type="range"] {
            width: 150px;
            margin-right: 10px;
        }
        #toggleMenu {
            position: absolute;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 15;
        }
        #toggleMenu.hidden {
            display: none;
        }
        select {
            width: 150px;
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 2px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    <button id="toggleMenu">Hide Menu</button>
    <div id="controls">
        <div>
            <label for="speed">Speed: </label>
            <input type="range" id="speed" min="0.1" max="15" step="0.1" value="7">
            <span id="speedValue">7</span>
        </div>
        <div>
            <label for="tailLength">Tail Length: </label>
            <input type="range" id="tailLength" min="0" max="1000" step="1" value="150">
            <span id="tailLengthValue">150</span>
        </div>
        <div>
            <label for="density">Density: </label>
            <input type="range" id="density" min="50" max="5000" step="10" value="750">
            <span id="densityValue">750</span>
        </div>
        <div>
            <label for="baseSize">Base Size: </label>
            <input type="range" id="baseSize" min="0.05" max="5" step="0.1" value="1">
            <span id="baseSizeValue">1.0</span>
        </div>
        <div>
            <label for="sizeVar">Size Variability: </label>
            <input type="range" id="sizeVar" min="0" max="2" step="0.05" value="0.8">
            <span id="sizeVarValue">0.8</span>
        </div>
        <div>
            <label for="colorShift">Color Shift: </label>
            <input type="range" id="colorShift" min="0" max="2" step="0.01" value="0.2">
            <span id="colorShiftValue">0.2</span>
        </div>
        <div>
            <label for="brightnessVar">Brightness Var: </label>
            <input type="range" id="brightnessVar" min="0.1" max="2" step="0.01" value="0.5">
            <span id="brightnessVarValue">0.5</span>
        </div>
        <div>
            <label for="fov">Field of View: </label>
            <input type="range" id="fov" min="0.1" max="3" step="0.1" value="0.1">
            <span id="fovValue">0.1</span>
        </div>
        <div>
            <label for="exclusionRadius">Exclusion Radius: </label>
            <input type="range" id="exclusionRadius" min="0" max="0.5" step="0.01" value="0.02">
            <span id="exclusionRadiusValue">0.25</span>
        </div>
        <div>
            <label for="fadeDuration">Fade-in ms: </label>
            <input type="range" id="fadeDuration" min="0" max="2000" step="10" value="1000">
            <span id="fadeDurationValue">300</span>
        </div>
        <div>
            <label for="starShape">Star Shape: </label>
            <select id="starShape">
                <option value="point">Point (Circle)</option>
                <option value="line" selected>Line (Tailed)</option>
            </select>
        </div>
    </div>
    <script>
        const canvas = document.getElementById('starfield');
        const ctx = canvas.getContext('2d');
        const speedSlider = document.getElementById('speed');
        const tailLengthSlider = document.getElementById('tailLength');
        const densitySlider = document.getElementById('density');
        const baseSizeSlider = document.getElementById('baseSize');
        const sizeVarSlider = document.getElementById('sizeVar');
        const colorShiftSlider = document.getElementById('colorShift');
        const brightnessVarSlider = document.getElementById('brightnessVar');
        const fovSlider = document.getElementById('fov');
        const exclusionRadiusSlider = document.getElementById('exclusionRadius');
        const fadeDurationSlider = document.getElementById('fadeDuration');
        const starShapeSelect = document.getElementById('starShape');
        const speedValue = document.getElementById('speedValue');
        const tailLengthValue = document.getElementById('tailLengthValue');
        const densityValue = document.getElementById('densityValue');
        const baseSizeValue = document.getElementById('baseSizeValue');
        const sizeVarValue = document.getElementById('sizeVarValue');
        const colorShiftValue = document.getElementById('colorShiftValue');
        const brightnessVarValue = document.getElementById('brightnessVarValue');
        const fovValue = document.getElementById('fovValue');
        const exclusionRadiusValue = document.getElementById('exclusionRadiusValue');
        const fadeDurationValue = document.getElementById('fadeDurationValue');
        const toggleMenu = document.getElementById('toggleMenu');
        const controls = document.getElementById('controls');

        let width, height, stars = [];
        let speed = parseFloat(speedSlider.value);
        let tailLength = parseFloat(tailLengthSlider.value);
        let density = parseInt(densitySlider.value);
        let baseSize = parseFloat(baseSizeSlider.value);
        let sizeVar = parseFloat(sizeVarSlider.value);
        let colorShift = parseFloat(colorShiftSlider.value);
        let brightnessVar = parseFloat(brightnessVarSlider.value);
        let fov = parseFloat(fovSlider.value);
        let exclusionRadius = parseFloat(exclusionRadiusSlider.value);
        let fadeDuration = parseFloat(fadeDurationSlider.value);
        let starShape = starShapeSelect.value;
        let menuVisible = true;
        let originX = window.innerWidth / 2;
        let originY = window.innerHeight / 2;

        function resizeCanvas() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            originX = (originX / width) * window.innerWidth;
            originY = (originY / height) * window.innerHeight;
            initStars();
        }

        class Star {
            constructor() {
                this.reset();
            }

            reset() {
                const maxRadius = Math.max(width, height) / 2;
                const exclusionRadiusPx = Math.min(width, height) * exclusionRadius;

                let x, y, sx, sy, z;
                do {
                    const rad = maxRadius * Math.sqrt(Math.random());
                    const theta = Math.random() * 2 * Math.PI;
                    x = rad * Math.cos(theta);
                    y = rad * Math.sin(theta);
                    z = Math.random() * width;
                    sx = (x / z) * Math.max(width, height) * fov + originX;
                    sy = (y / z) * Math.max(width, height) * fov + originY;
                } while (
                    Math.sqrt((sx - originX) ** 2 + (sy - originY) ** 2) <= exclusionRadiusPx
                );

                this.x = x;
                this.y = y;
                this.z = z;
                this.size = baseSize + (Math.random() - 0.5) * 2 * sizeVar;
                this.size = Math.max(0.1, this.size);
                const rShift = (Math.random() - 0.5) * colorShift * 255;
                const gShift = (Math.random() - 0.5) * colorShift * 100;
                const bShift = (Math.random() - 0.5) * colorShift * 255;
                const r = Math.min(255, Math.max(200, 255 + rShift));
                const g = Math.min(255, Math.max(200, 255 + gShift));
                const b = Math.min(255, Math.max(200, 255 + bShift));
                this.targetOpacity = 0.5 - Math.random() * brightnessVar;
                this.opacity = 0;
                this.fadeStartTime = performance.now();
                this.fadeDuration = fadeDuration;
                this.baseColor = { r, g, b };
                this.color = `rgba(${r}, ${g}, ${b}, ${this.opacity})`;
            }

            updateOpacity() {
                const elapsed = performance.now() - this.fadeStartTime;
                if (elapsed < this.fadeDuration) {
                    this.opacity = this.targetOpacity * (elapsed / this.fadeDuration);
                } else {
                    this.opacity = this.targetOpacity;
                }
                this.color = `rgba(${this.baseColor.r}, ${this.baseColor.g}, ${this.baseColor.b}, ${this.opacity})`;
            }

            update() {
                this.z -= speed;
                if (this.z <= 0) {
                    this.reset();
                }
                this.updateOpacity();
            }

            draw() {
                const sx = (this.x / this.z) * Math.max(width, height) * fov + originX;
                const sy = (this.y / this.z) * Math.max(width, height) * fov + originY;
                const px = (this.x / (this.z + tailLength)) * Math.max(width, height) * fov + originX;
                const py = (this.y / (this.z + tailLength)) * Math.max(width, height) * fov + originY;

                ctx.beginPath();
                if (starShape === 'line') {
                    const gradient = ctx.createLinearGradient(sx, sy, px, py);
                    gradient.addColorStop(0, this.color);
                    gradient.addColorStop(1, `rgba(${this.baseColor.r}, ${this.baseColor.g}, ${this.baseColor.b}, 0)`);
                    ctx.moveTo(sx, sy);
                    ctx.lineTo(px, py);
                    ctx.strokeStyle = gradient;
                    ctx.lineWidth = this.size;
                    ctx.stroke();
                } else if (starShape === 'point') {
                    ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }
        }

        function initStars() {
            stars = [];
            for (let i = 0; i < density; i++) {
                stars.push(new Star());
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
            ctx.fillRect(0, 0, width, height);
            stars.forEach(star => {
                star.update();
                star.draw();
            });
            requestAnimationFrame(animate);
        }

        canvas.addEventListener('click', (event) => {
            const rect = canvas.getBoundingClientRect();
            originX = event.clientX - rect.left;
            originY = event.clientY - rect.top;
            initStars();
        });

        speedSlider.addEventListener('input', () => {
            speed = parseFloat(speedSlider.value);
            speedValue.textContent = speed.toFixed(1);
        });

        tailLengthSlider.addEventListener('input', () => {
            tailLength = parseFloat(tailLengthSlider.value);
            tailLengthValue.textContent = tailLength;
        });

        densitySlider.addEventListener('input', () => {
            density = parseInt(densitySlider.value);
            densityValue.textContent = density;
            initStars();
        });

        baseSizeSlider.addEventListener('input', () => {
            baseSize = parseFloat(baseSizeSlider.value);
            baseSizeValue.textContent = baseSize.toFixed(1);
            initStars();
        });

        sizeVarSlider.addEventListener('input', () => {
            sizeVar = parseFloat(sizeVarSlider.value);
            sizeVarValue.textContent = sizeVar.toFixed(1);
            initStars();
        });

        colorShiftSlider.addEventListener('input', () => {
            colorShift = parseFloat(colorShiftSlider.value);
            colorShiftValue.textContent = colorShift.toFixed(2);
            initStars();
        });

        brightnessVarSlider.addEventListener('input', () => {
            brightnessVar = parseFloat(brightnessVarSlider.value);
            brightnessVarValue.textContent = brightnessVar.toFixed(2);
            initStars();
        });

        fovSlider.addEventListener('input', () => {
            fov = parseFloat(fovSlider.value);
            fovValue.textContent = fov.toFixed(1);
        });

        exclusionRadiusSlider.addEventListener('input', () => {
            exclusionRadius = parseFloat(exclusionRadiusSlider.value);
            exclusionRadiusValue.textContent = exclusionRadius.toFixed(2);
            initStars();
        });

        fadeDurationSlider.addEventListener('input', () => {
            fadeDuration = parseFloat(fadeDurationSlider.value);
            fadeDurationValue.textContent = fadeDuration.toFixed(0);
            initStars();
        });

        starShapeSelect.addEventListener('change', () => {
            starShape = starShapeSelect.value;
            tailLengthSlider.disabled = starShape === 'point';
        });

        toggleMenu.addEventListener('click', () => {
            menuVisible = !menuVisible;
            controls.classList.toggle('hidden', !menuVisible);
            toggleMenu.textContent = menuVisible ? 'Hide Menu' : 'Show Menu';
            toggleMenu.style.top = menuVisible ? `${controls.offsetHeight + 20}px` : '10px';
        });

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        baseSizeValue.textContent = baseSize.toFixed(1);
        sizeVarValue.textContent = sizeVar.toFixed(1);
        exclusionRadiusValue.textContent = exclusionRadius.toFixed(2);
        fadeDurationValue.textContent = fadeDuration.toFixed(0);
        toggleMenu.style.top = `${controls.offsetHeight + 20}px`;
        initStars();
        animate();
    </script>
</body>
</html>
